# 特征提取(Feature Exactor) 2

## SIFT 特征点检测

* ### SIFT算法简介
    尺度不变特征转换即SIFT (Scale-invariant feature transform)是一种计算机视觉的算法。它用来侦测与描述影像中的局部性特征，它在空间尺度中寻找极值点，并提取出其位置、尺度、旋转不变量，此算法由 David Lowe在1999年所发表，2004年完善总结。
    局部影像特征的描述与侦测可以帮助辨识物体，SIFT特征是基于物体上的一些局部外观的兴趣点而与影像的大小和旋转无关。对于光线、噪声、些微视角改变的容忍度也相当高。基于这些特性，它们是高度显著而且相对容易撷取，在母数庞大的特征数据库中，很容易辨识物体而且鲜有误认。使用 SIFT特征描述对于部分物体遮蔽的侦测率也相当高，甚至只需要3个以上的SIFT物体特征就足以计算出位置与方位。在现今的电脑硬件速度下和小型的特征数据库条件下，辨识速度可接近即时运算。SIFT特征的信息量大，适合在海量数据库中快速准确匹配。
    SIFT算法的实质是在不同的尺度空间上查找关键点(特征点)，并计算出关键点的方向。SIFT所查找到的关键点是一些十分突出，不会因光照，仿射变换和噪音等因素而变化的点，如角点、边缘点、暗区的亮点及亮区的暗点等

    * **哪些是关键点**
    这些点是一些十分突出的点，不会因为光照条件的改变二消失，比如角点、边缘点、暗区域的亮点、亮区域的暗点，既然两幅图像有相同的景物，那么使用某种方法分别提取各自的稳定点，这些点之间会有相互对应的匹配点。
    所谓关键点，就是在不同尺度空间的图像下检测出的具有方向信息的局部极值点。
    根据归纳，特征点具备三个属性: **方向、尺度、大小**

    * **什么是尺度空间**
    一个图像的尺度空间 $\mathrm{L}(\mathrm{x}, \mathrm{y}, \sigma)$ ，定义为原始图像$\mathrm{I}(\mathrm{x}, \mathrm{y})$ 与一个可变尺度的2维高斯函数$\mathrm{G}(\mathrm{x}, \mathrm{y}, \sigma)$ 的卷积运算。
    高斯函数：
        $$\begin{array}{c}
        G\left(x_{i}, y_{i}, \sigma\right)=\frac{1}{2 \pi \sigma^{2}} \exp \left(-\frac{\left(x-x_{i}\right)^{2}+\left(y-y_{i}\right)^{2}}{2 \sigma^{2}}\right)
        \end{array}$$
        $$\begin{array}{c}
        L(x, y, \sigma)=G(x, y, \sigma) * I(x, y)
        \end{array}$$

    * **算法流程**

    ![img6](res/image6.png)

* ### SIFT 算法步骤
    * **图像金字塔**
        * **高斯金字塔**
        图像高斯金字塔(Gaussian Pyramid)是采用高斯函数对图像进行模糊以及降采样处理得到。其形成过程可如下图所示：
        ![img7](res/image7.jpg)
        我们还可以通过图像的模糊程度来模拟人在距离物体由远到近时物体在视网膜上成像过程，距离物体越近其尺寸越大图像也越模糊，这就是高斯尺度空间，使用不同的参数模糊图像（分辨率不变），是尺度空间的另一种表现形式。
        我们知道图像和高斯函数进行卷积运算能够对图像进行模糊，使用不同的“高斯核”可得到不同模糊程度的图像。一副图像其高斯尺度空间可由其和不同的高斯卷积得到：
        $$L(x,y,\sigma) = G(x,y,\sigma) * I(x,y)$$
        其中$G(x,y,\sigma)$是高斯核函数。
        $$G(x,y,\sigma) = \frac{1}{2 \pi \sigma ^2} e ^ {\frac{x^2 +y^2}{2 \sigma^2}}$$
        $\sigma$称为尺度空间因子，它是高斯正态分布的标准差，反映了图像被模糊的程度，其值越大图像越模糊，对应的尺度也就越大。$L(x, y, \sigma)$代表着图像的高斯尺度空间。
        构建尺度空间的目的是为了检测出在不同的尺度下都存在的特征点，而检测特征点较好的算子是$\Delta^2G$(高斯拉普拉斯, $LoG$）,
        $$\Delta ^2 = \frac{\partial ^2}{\partial x^2} + \frac{\partial ^2}{\partial y^2}$$

        * **高斯函数与图像卷积**
        使用N x N的模板在图像每一个像素点处操作，其中$\mathrm{N}=[(6 \sigma+1)]$且向上取最邻近奇数。
        ![img8](res/image8.jpg)

        * **高斯分离卷积**
        上面这样直接与图像卷积，速度比较慢，同时图像边缘信息也会损失严重。后来，后来，不知哪位学者发现，可以使用分离的高斯卷积（即先用1xN的模板沿着X方向对图像卷积一次，然后用Nx1的模板沿着Y方向对图像再卷积一次，其中$\mathrm{N}=[(6 \sigma+1)]$且向上取最邻近奇数），这样既省时也减小了直接卷积对图像边缘信息的严重损失。
        ![img9](res/image9.jpg)

    * **高斯差分金字塔**
    2002年Mikolajczyk在详细的实验比较中发现尺度归一化的高斯拉普拉斯函数的极大值和极小值同其它的特征提取函数，例如：梯度，Hessian或Harris角特征比较，能够产生最稳定的图像特征。而Lindeberg早在1994年就发现高斯差分函数（简称DOG算子）与尺度归一化的高斯拉普拉斯函数非常近似。如下式：
    $$\mathrm{G}(x, y, k\sigma) - \mathrm{G}(x,y,\sigma) \approx (k-1)\sigma^2\nabla^2G$$
    其中k-1是个常数，并不影响极值点位置的求取
    结合上面的高斯拉普拉斯算子：
    $$\nabla ^2G = \frac{\partial ^2G}{\partial x^2} + \frac{\partial ^2G}{\partial y^2}$$
    尺度规范化的$LoG$算子：
    $$\sigma^2\nabla^2G$$
        * **差分金子塔的建立**
        差分金字塔的是在高斯金字塔的基础上操作的，其建立过程是：在高斯金子塔中的每组中相邻两层相减（下一层减上一层）就生成高斯差分金字塔.
        高斯差分金字塔其操作如下图：
        ![img10](res/image10.jpg)
        在减小图像尺寸的场合经常使用高斯模糊，在进行欠采样时，通常在采样之前进行低通滤波处理。这样就保证在采样时图像中不会出现虚假的高频信息。
        高斯模糊：
        $$\mathrm{G}(r)=\frac{1}{2\pi\sigma^2}\exp\left(-\frac{r^2}{2\sigma^2}\right)$$